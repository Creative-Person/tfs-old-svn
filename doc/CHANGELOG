[ CHANGELOG
	Project Name
		The Forgotten Server

	Version
		0.3 Beta 1

	Codenamed
		\

	License
		GNU GPLv3

	Forum
		http://otland.net/
]

[ File changes:
	D = Deleted,
	M = Modified,
	A = Added.

	A...
		data/
			compat.lua
				* Added for compatibility with other engines - will contain deprecated functions

			functions.lua
				* Contains all lua-made functions from global.lua

			actions/
				actions.xml
				scripts/
					liquids/
						*.lua
							* Added liquids files
							* Added potions of 8.11 protocol

					tools/
						blessed_wooden_stake.lua
						obsidian_knife.lua
							* Added
						fishing.lua
							* Fixed worms usage

			creaturescripts/
				scripts/
					firstitems.lua
						* Moved first items script to creature events instead of move events

			npc/
				*.xml
				scripts/
					*.lua
						* Added more NPC's examples

			talkactions/
				scripts/
					online.lua
						* Talkaction based on new LUA function, deprecated from commands
					shutdown.lua
						* Talkaction based on new LUA function
					clean.lua
						* Talkaction based on new LUA function, deprecated from commands
					position.lua
						* Talkaction deprecated from commands
					money.lua
						* Talkaction deprecated from commands
					broadcast.lua
						* Talkaction based on new LUA function, deprecated from commands
					broadcastclass.lua
						* Added (...)
					pvp.lua
						* Talkaction based on new LUA function, added (...)
					mode.lua
						* Added (...)

			weapons/
				scripts/
					burst_arrow.lua
						* Moved explosive_arrow.lua
					earth/
						*.lua
							* Enchanted weapons scripts
					energy/
						*.lua
							* Enchanted weapons scripts
					fire/
						*.lua
							* Enchanted weapons scripts
					ice/
						*.lua
							* Enchanted weapons scripts

	M...
		data/
			creaturescripts/
				creaturescripts.xml
					* Moved first items script to creature events instead of move events
				scripts/
					playerdeath.lua
						* Updated due to changed escapeString return

			items/
				items.xml
					* Fixed formatting
					* Corrected alot of attribute values
					* Corrected alot of item names
					* Added protocol 8.11 potions
					* Compatibility with protocol 8.11
				items.otb
					* Compatibility with protocol 8.11

			monster/
				monsters.xml
					*/*.xml
						* Added all monsters of protocol 8.1
						* Updated few to protocol 8.11
						* Added missing monsters and bosses

			movements/
				scripts/
					swimming/
						*.lua
							* Added swimming system

				movements.xml
					* Added swimming system
					* Moved first items script to creature events instead of move events

			spells/
				lib/
					spells.lua
						* Added all new corpses to the CORPSES array
						* Fixed some spell areas
				scripts/
					*.lua
						* Fixes
				spells.xml
					* Added "exhaustion=" back to spells.xml
					* Charges and names fixed

			talkactions/
				talkactions.xml
					* Added clean.lua and shutdown.lua
					* Added money.lua and position.lua
					* Added new access system tags (access="")
					* Added log="" tags responsible for talkaction logging
				lib/
					talkactions.lua
						* Added talkactionLogger(cid, words, param) function using doWriteLogFile(file, text) from global.lua
						* Removed the logger - new access system handles that
				scripts/
					*.lua
						* Added logger callbacks to few files
						* Removed permission checking from access needing talkactions
						* Removed logger callbacks from files
					changesex.lua
						* Updated due to deprecated LUA function
						* Added a check for gratis premium account
					deathlist.lua
						* Updated due to changed escapeString return

			world/
				*.xml
				forgotten.otbm
					* Placed some NPC's on the map

			XML/
				commands.xml
					* Replaced old tags of acctype="" and group="" to new access system access=""
					* Added log="" tags responsible for commands logging

			global.lua
				* Added getConfigInfo(info), doWriteLogFile(file, text), getPosByDir(basePos, dir) and hasCondition(cid, condition) functions
				* Fixed conditions values
				* Split to functions.lua and compat.lua
				* Added guild levels
				* Re-grouped global.lua

	D...
		data/
			actions/
				scripts/
					fluids.lua
					potions.lua

			movements/
				scripts/
					firstitems.lua
						* Moved first items script to creature events instead of move events

			weapons/
				scripts/
					explosive_arrow.lua
]

[ Milestone
	[ Note
		Some of the features were added to Mystic Spirit (0.2) due popularity of them.
	]

	White skull time configurable on config.lua (Talaturen)
	Time to decrease frags on config.lua (Talaturen)
	Added all monsters of protocol 8.22 (Lithium, OpenTibia SVN)
	Attackspeed for items in items.xml (Talaturen)
	Basespeed in vocations.xml (Talaturen)
	onLook(cid, pos) creaturescript event (Talaturen)
	/pvp command to change worldtype (Talaturen)
	/goto command (/goto x y z) (Talaturen)
	Configurable level to form guild (Talaturen)
	Replaced party system with the party system from OpenTibias avesta branch (Talaturen)
	Added more NPC's and placed in the map (Lithium, Elf)
	Swimming system (Lithium, OpenTibia SVN)
	Global Storage values saving in database (Elf, OpenTibia SVN)
	Configurable level to buy and sell house (Elf)
	Configurable amount (0 to disable) of houses per each account (Elf)
	/send command (/send player, x y z) (Elf)
	Configurable permission for talkactions in talkactions.xml (Elf)
	Ingame guild management 'switch' on config.lua (Elf)
	House buying and selling disabling on config.lua (Elf)
	Namelock Manager while Account Manager is disabled configurable in config.lua (Elf)
	onKill(cid, target) creaturescript event (Elf)
	onAdvance(cid, skill, oldlevel, newlevel) creaturescript event (Elf)
	onThink creaturescript event for creatures (Elf)
	onThink and onLook events aren't fired global anymore (Elf)
	/squelch command to disable private messages receiving (Elf)
	Dropped account types and replaced it with access levels (Elf, Talaturen)
	Custom flags system (Elf, Talaturen)
	Possibility to move items from far, push not pushable items and throw items anywhere (Elf, Nate's code)
	Configurable commands and talkactions logging (Elf)
	Ghost Mode (Elf, Pedro B's code)
	Patched cascading actions (Elf, OpenTibiaSVN)
	Rewritten ban class (Elf, Talaturen)
	Bank system (Elf, OpenTibiaSVN)
	Stamina system (Elf, Cayan's Code)
	Moved players record and motd to database (Elf)
	Moved CTRL + Z bug reports to database, written /reports command (Elf)
	Marriage system (Elf)
]

[ Deprecated
	[ Note
		All deprecated Lua functions are stored in compat.lua and use their equivalents, nevertheless please use proper ones for new scripts.
	]

	Command: !kills, use !frags.
	Command: /clean, use /clean from talkactions
	Command: /pos, use /pos from talkactions
	Command: /q, use /q from talkactions
	Command: /B, use #b or /b from talkactions
	Command: /b, use violation window for banning
	Command: /pvp, use /pvp from talkactions
	LuaFunction: savePlayers(), use saveData().
	LuaFunction: doPlayerAddMana(cid, mana), use doCreatureAddMana(cid, mana)
	LuaFunction: broadcastMessage(cid, type), use doBroadcastMessage(cid, type)
	LuaFunction: getPlayerPosition(cid), use getCreaturePosition(cid)
	LuaFunction: getPlayerName(cid), use getCreatureName(cid)
	LuaFunction: getCreaturePos(cid) [fake], use getCreaturePosition(cid)
	LuaFunction: saveData(), use saveServer()
	LuaFunction: doPlayerRemovePremiumDays(cid, days), use: doPlayerAddPremiumDays(cid, -days) [negative values]
	LuaFunction: doPlayerRemOutfit(cid, looktype, addons), use: doPlayerRemoveOutfit(cid, looktype, addons)
	LuaFunction: doSetCreatureDropLoot(cid, doDrop), use: doCreatureSetDropLoot(cid, doDrop)
]

[ MySQL Update Queries
	CREATE TABLE `server_motd`
	(
		`id` INT NOT NULL AUTO_INCREMENT,
		`text` TEXT NOT NULL,
		PRIMARY KEY (`id`)
	) ENGINE = InnoDB;

	CREATE TABLE `server_record`
	(
		`record` INT NOT NULL,
		`timestamp` BIGINT NOT NULL,
		PRIMARY KEY (`timestamp`)
	) ENGINE = InnoDB;

	CREATE TABLE `global_storage`
	(
		`key` INT UNSIGNED NOT NULL,
		`value` INT NOT NULL,
		PRIMARY KEY  (`key`)
	) ENGINE = InnoDB;

	INSERT INTO `server_record` VALUES (0, 0);
	INSERT INTO `server_motd` VALUES (1, 'Welcome to The Forgotten Server!');

	DROP TABLE `bans`;
	CREATE TABLE `bans`
	(
		`id` INT UNSIGNED NOT NULL auto_increment,
		`type` TINYINT(1) NOT NULL COMMENT 'this field defines if its ip, account, player, or any else ban',
		`value` INT UNSIGNED NOT NULL COMMENT 'ip, player guid, account number',
		`param` INT UNSIGNED NOT NULL DEFAULT 4294967295 COMMENT 'mask',
		`active` TINYINT(1) NOT NULL DEFAULT TRUE,
		`expires` INT UNSIGNED NOT NULL,
		`added` INT UNSIGNED NOT NULL,
		`admin_id` INT UNSIGNED NOT NULL DEFAULT 0,
		`comment` TEXT NOT NULL DEFAULT '',
		`reason` INT UNSIGNED NOT NULL DEFAULT 0,
		`action` INT UNSIGNED NOT NULL DEFAULT 0,
		PRIMARY KEY  (`id`),
		KEY `type` (`type`, `value`)
	) ENGINE = InnoDB;

	TRUNCATE TABLE `groups`;
	ALTER TABLE `groups` ADD `customflags` BIGINT UNSIGNED NOT NULL DEFAULT 0 AFTER `flags`;
	ALTER TABLE `groups` ADD `violationaccess` INT NOT NULL AFTER `access`;
	INSERT INTO `groups` VALUES (1, 'Player', 0, 0, 0, 0, 0, 0);
	INSERT INTO `groups` VALUES (2, 'Tutor', 16809984, 1, 1, 0, 0, 0);
	INSERT INTO `groups` VALUES (3, 'Senior Tutor', 68736352256, 3, 2, 1, 0, 0);
	INSERT INTO `groups` VALUES (4, 'Game Master', 492842123151, 63, 3, 2, 4000, 200);
	INSERT INTO `groups` VALUES (5, 'Community Manager', 542239465466, 1279, 4, 3, 6000, 300);
	INSERT INTO `groups` VALUES (6, 'God', 546534563834, 2047, 5, 3, 8000, 400);

	ALTER TABLE `players` ADD `balance` BIGINT UNSIGNED NOT NULL DEFAULT 0 AFTER `blessings`;
	ALTER TABLE `players` ADD `stamina` BIGINT UNSIGNED NOT NULL DEFAULT 201660000 AFTER `balance`;
	ALTER TABLE `players` CHANGE `loss_experience` `loss_experience` INT NOT NULL DEFAULT 10;
	ALTER TABLE `players` CHANGE `loss_mana` `loss_mana` INT NOT NULL DEFAULT 10;
	ALTER TABLE `players` CHANGE `loss_skills` `loss_skills` INT NOT NULL DEFAULT 10;
	ALTER TABLE `players` ADD `loss_items` INT NOT NULL DEFAULT 10 AFTER `loss_skills`;
	ALTER TABLE `players` ADD `marriage` INT UNSIGNED NOT NULL DEFAULT 0;
	UPDATE `players` SET `loss_experience` = 10, `loss_mana` = 10, `loss_skills` = 10, `loss_items` = 10;

	ALTER TABLE `accounts` DROP `type`;
	ALTER TABLE `player_deaths` DROP `is_player`;

	ALTER TABLE `houses` CHANGE `warnings` `warnings` INT NOT NULL DEFAULT 0;
	ALTER TABLE `houses` ADD `lastwarning` INT UNSIGNED NOT NULL DEFAULT 0;
]

[ MySQL Update Triggers
	DROP TRIGGER IF EXISTS `ondelete_accounts`;
	DROP TRIGGER IF EXISTS `ondelete_players`;

	DELIMITER |
	CREATE TRIGGER `ondelete_accounts`
	BEFORE DELETE
	ON `accounts`
	FOR EACH ROW
	BEGIN
	    DELETE FROM `bans` WHERE `type` != 1 AND `type` != 2 AND `value` = OLD.`id`;
	END|

	CREATE TRIGGER `ondelete_players`
	BEFORE DELETE
	ON `players`
	FOR EACH ROW
	BEGIN
	    DELETE FROM `bans` WHERE `type` = 2 AND `value` = OLD.`id`;
	    UPDATE `houses` SET `owner` = 0 WHERE `owner` = OLD.`id`;
	END|
	DELIMITER ;
]

[ SqLite Update Queries and Triggers
	Please use newest forgottenserver.s3b file.
]

[ Fixed issues with...
	Last house warnings (OpenTibia SVN)
	High CPU usage (OpenTibia SVN)
	PVP Zones skill loss and item drop (Talaturen, Elf, OpenTibia SVN)
	Bed sleepers not loading (Elf)
	Items with 0 charges not being removed (Elf, Kiper)
]